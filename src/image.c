typedef unsigned long pixel;
typedef unsigned char byte;

#include "error.c"

pixel palette[] = {
    0xFFFFFFFF,
    0xFFFF0000,
    0xFF00FF00,
    0xFF0000FF,
    0xFF000000,
    0xFF101010,
    0xFF202020,
    0xFF303030,
    0xFF404040,
    0xFF505050,
    0xFF606060,
    0xFF707070,
    0xFF808080,
    0xFF909090,
    0xFFA0A0A0,
    0xFFB0B0B0,
    0xFFC0C0C0,
    0xFFD0D0D0,
    0xFFE0E0E0,
    0xFF080808,
};

typedef struct Image {
    pixel *pixels;
    int width;
    int height;
} Image;

pixel transparent = 0x00FFFFFF;

Image *CreateImage(int width, int height) {
    Image *image = (Image *) malloc(sizeof(Image));

    image->pixels = (pixel *) malloc(sizeof(pixel) * width * height);
    image->width = width;
    image->height = height;

    return image;
} 

void ClearImage(Image *image) {
    free(image->pixels);
    free(image);
} 

Image *ParseImage(byte *bytes) {
    int width = bytes[0];
    int height = bytes[1];

    Image *image = CreateImage(width, height);

    int i;
    for (i = 0; i < width * height; i++) {
        image->pixels[i] = palette[bytes[i + 2]];
    }

    return image;
}

void InvertColors(Image *image) {
    int i;
    for (i = 0; i < image->width * image->height; i++) {
        byte a = image->pixels[i] >> 24;
        byte r = image->pixels[i] >> 16;
        byte g = image->pixels[i] >> 8;
        byte b = image->pixels[i];

        image->pixels[i] = ((pixel) ((byte) a) << 24) + ((pixel) ((byte) 255 - r) << 16) + ((pixel) ((byte) 255 - g) << 8) + (pixel) ((byte) 255 - b);
    }
}

void IncreaseLight(Image *image, byte intensity) {
    int i;

    for (i = 0; i < image->width * image->height; i++) {
        byte a = image->pixels[i] >> 24;
        byte r = image->pixels[i] >> 16;
        byte g = image->pixels[i] >> 8;
        byte b = image->pixels[i];

        r += intensity;
        if (r < intensity) {
            r = 255;
        } 

        g += intensity;
        if (g < intensity) {
            g = 255;
        }

        b += intensity;
        if (b < intensity) {
            b = 255;
        }

        image->pixels[i] = ((pixel) a << 24) + ((pixel) r << 16) + ((pixel) g << 8) + (pixel) b;
    }
} 

void DecreaseLight(Image *image, byte intensity) {
    int i;

    for (i = 0; i < image->width * image->height; i++) {
        byte a = image->pixels[i] >> 24;
        byte r = image->pixels[i] >> 16;
        byte g = image->pixels[i] >> 8;
        byte b = image->pixels[i];

        if (intensity > r) {
            r = 0;
        } else {
            r -= intensity;
        }

        if (intensity > g) {
            g = 0;
        } else {
            g -= intensity;
        }

        if (intensity > b) {
            b = 0;
        } else {
            b -= intensity;
        }

        image->pixels[i] = ((pixel) a << 24) + ((pixel) r << 16) + ((pixel) g << 8) + (pixel) b;
    }
} 

byte button_wide[] = {
    64, 16,
    8, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 5, 
    8, 8, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 5, 5, 
    8, 8, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 5, 5, 
    8, 8, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 5, 5, 
    8, 8, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 5, 5, 
    8, 8, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 5, 5, 
    8, 8, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 5, 5, 
    8, 8, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 5, 5, 
    8, 8, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 5, 5, 
    8, 8, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 5, 5, 
    8, 8, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 5, 5, 
    8, 8, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 5, 5, 
    8, 8, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 5, 5, 
    8, 8, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 5, 5, 
    8, 8, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 5, 5, 
    8, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 5  
};

byte button_square[] = {
    16, 16,
    8, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 5, 
    8, 8, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 5, 5, 
    8, 8, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 5, 5, 
    8, 8, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 5, 5, 
    8, 8, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 5, 5, 
    8, 8, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 5, 5, 
    8, 8, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 5, 5, 
    8, 8, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 5, 5, 
    8, 8, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 5, 5, 
    8, 8, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 5, 5, 
    8, 8, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 5, 5, 
    8, 8, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 5, 5, 
    8, 8, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 5, 5, 
    8, 8, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 5, 5, 
    8, 8, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 5, 5, 
    8, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 5  
};

byte checkbox[] = {
    16, 16,
    8, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 5, 
    8, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 5, 
    8, 7, 5, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 7, 5, 
    8, 7, 5, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 7, 5, 
    8, 7, 5, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 7, 5, 
    8, 7, 5, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 7, 5, 
    8, 7, 5, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 7, 5, 
    8, 7, 5, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 7, 5, 
    8, 7, 5, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 7, 5, 
    8, 7, 5, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 7, 5, 
    8, 7, 5, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 7, 5, 
    8, 7, 5, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 7, 5, 
    8, 7, 5, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 7, 5, 
    8, 7, 5, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 7, 5, 
    8, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 5, 
    8, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 5  
};